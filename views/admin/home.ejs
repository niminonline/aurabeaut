<%-include("../layout/adminHeader.ejs")%>

<div class="container-fluid">
  <h2>Welcome Admin....</h2>
  
  </div>

  <div class="card-row row m-4 d-flex justify-content-around">

    
    <!-- -----------------Start Card------------------ -->
    <div class="card bg-primary dashboard-card" style="width: 18rem;"> 
      <h2 class="card-title my-4 text-white text-center">Orders Placed today</h2>
      <div class="card-body ">
       
        <!-- <img src="..." class="card-img-top" alt="..."> -->
        <h1 class=" mb-2  text-white text-center"><%=orderToday%> Orders</h1>
       
      </div>
    </div>
    <!-- -----------------End Card------------------ -->

    <!-- -----------------Start Card------------------ -->
    <div class="card bg-danger dashboard-card" style="width: 18rem;"> 
        <h2 class="card-title my-4 text-white text-center">Pending</h2>
      <div class="card-body ">
        
        <!-- <img src="..." class="card-img-top" alt="..."> -->
        <h1 class=" mb-2  text-white text-center"><%=PendingCount%> Orders</h1>
      </div>
    </div>
    <!-- -----------------End Card------------------ -->
    
    <!-- -----------------Start Card------------------ -->
    <div class="card bg-warning dashboard-card" style="width: 18rem;"> 
        <h2 class="card-title my-4 text-white text-center">Sales today</h2>
    
      <div class="card-body ">
       
        <!-- <img src="..." class="card-img-top" alt="..."> -->
        <h1 class=" mb-2  text-white text-center">₹<%=salesToday%></h1>
       
      </div>
    </div>
    <!-- -----------------End Card------------------ -->
    <!-- -----------------Start Card------------------ -->
    <div class="card bg-success dashboard-card" style="width: 18rem;"> 
      <h2 class="card-title my-4 text-white text-center">Total Revenue</h2>
      <div class="card-body ">
       
        <!-- <img src="..." class="card-img-top" alt="..."> -->
        <h1 class=" mb-2  text-white text-center">₹<%=totalRevenue%></h1>
       
      </div>
    </div>
    <!-- -----------------End Card------------------ -->

     




  </div>
  <!-- </div> -->
 


  <!-- ----------------------------------Start Charts----------------------->
  <div class="row d-flex justify-content-around">
<!-- -----------Start Single Chart--------------- -->
<div class="col-md-3 m-4 chart-card">
  <!-- <div style="width: 400px;height: 400px;"> -->
    <h4 class="text-center my-3 p-4">Daily Sales</h4>
    <canvas id="dailySalesContainer"></canvas>
  </div>

<!-- -----------End Single Chart--------------- -->


<!-- -----------Start Single Chart--------------- -->
<div class="col-md-3 m-4 chart-card">
  <!-- <div style="width: 400px;height: 400px;"> -->
    <h4 class="text-center my-3 p-4">Daily Orders</h4>
    <canvas id="dailyOrderContainer"></canvas>
  </div>
  
  <!-- -----------End Single Chart--------------- -->
  
  <!-- -----------Start Single Chart--------------- -->
  <div class="col-md-3 m-4 p-4 chart-card">
    <!-- <div style="width: 400px;height: 400px;"> -->
      <h4 class="text-center my-3">Payment Modes</h4>
      <canvas id="paymentModeContainer"></canvas>
    </div>
  
  <!-- -----------End Single Chart--------------- -->
</div>
  

  <!-- ----------------------------------End Charts---------------------- -->


<!-- ------------------------ Start Sales Report-------------------------- -->


<div class="sales-report-block m-4 rounded chart-card py-4">
  <h4 class="text-center my-3 py-3">Sales Report</h4>
  <form action=""></form>
  <div class="input-fields-block container">
  <div class="form-group my-4">
    <label for="startDate">Select start date</label>
    <input type="date" class="form-control" id="startDate" >
    <!-- <small id="emailHelp" class="form-text text-muted"></small> -->
  </div>


  <div class="form-group">
    <label for="endDate">Select End date</label>
    <input type="date" class="form-control" id="endDate" >
    <!-- <small id="emailHelp" class="form-text text-muted"></small> -->
  </div>

<button class="btn btn-primary my-4" onclick="getSalesReport()">Get details</button>

</div>


</div>


<!-- ------------------------ End Sales Report-------------------------- -->


  <script>

    // ------------------Start Chart Script----------------------
    const paymentModeFun= async ()=>{
      const pmc = document.getElementById('paymentModeContainer');

      fetch("/admin/get-paymentmodes",{method:"get"})
      .then(response=>response.json())
      .then(data=>{
        // console.log(data)

        new Chart(pmc, {
        type: 'pie',
      data: {
        labels:  Object.keys(data),
        datasets: [{
          label: 'Number of orders',
          data: Object.values(data),
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: false
          }
        }
      }
    });
      })
    }
  
// --------------------------------------------//

    const dailySalesChart= async()=>{

  const dsc = document.getElementById('dailySalesContainer');

fetch("/admin/daily-sales-chart",{method:"get"})
.then(response=>response.json())
.then(data=>{
  // console.log(data);
  const labels= []
  const chartData= []
data.map(item=>{
  labels.push(item._id)
  chartData.push(item.totalPrice)
})
console.log(labels);
console.log(chartData);
  
  

  new Chart(dsc, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: 'Total Sales per day Rs',
      data:chartData,
      borderWidth: 1
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true
      }
    }
  }
});

})
    }


const dailyOrderChart= async ()=>{

  const dsc = document.getElementById('dailyOrderContainer');

fetch("/admin/daily-order-chart",{method:"get"})
.then(response=>response.json())
.then(data=>{
  // console.log(data);
  const labels= []
  const chartData= []
data.map(item=>{
  labels.push(item._id)
  chartData.push(item.count)
})
console.log(labels);
console.log(chartData);
  
  

  new Chart(dsc, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{
      label: 'Total order per day',
      data:chartData,
      borderWidth: 1
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true
      }
    }
  }
});

})
    }


paymentModeFun();
dailySalesChart();
dailyOrderChart();
    
    
    
    // ------------------Start Chart Script----------------------

  const getSalesReport=()=>{

    const startDate= document.getElementById("startDate").value
    const endDate= document.getElementById("endDate").value
    
    if(startDate==""|| endDate==""){
      new swal("Please select a date")
    }
    else if(startDate> endDate){
      new swal("Start date must be less than end date")
    }
    else{
      console.log(startDate)
    console.log(endDate)

    fetch(`/admin/generate-sales-report`,{method:'post',headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer token123'
    },
    body: JSON.stringify({
      
      startDate: startDate,
      endDate:endDate
        
      
  })
  })

    }
  }
    
</script>
    
    
<%-include("../layout/adminFooter.ejs")%>
